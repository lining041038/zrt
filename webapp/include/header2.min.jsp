<%@page import="antelope.services.supportclasses.Header2Params"%>
<%@page import="antelope.services.JSPUtilService"%>
<%@page import="antelope.consts.GlobalConsts"%>
<%@page import="antelope.interfaces.components.BaseUIOptions"%>
<%@page import="antelope.utils.SystemOpts"%>
<%@page import="java.util.regex.Pattern"%>
<%@page import="antelope.utils.RegExpUtil"%>
<%@page import="antelope.utils.I18n"%>
<%@page import="antelope.interfaces.OptionsProvider"%>
<%@page import="antelope.utils.JSONObject"%>
<%@page import="antelope.interfaces.components.BaseUIComponent"%>
<%@page import="antelope.utils.TextUtils"%>
<%@page import="org.springframework.transaction.TransactionStatus"%>
<%@page import="antelope.springmvc.SpringUtils"%>
<%@page import="antelope.services.SessionService"%>
<%@ page language="java" pageEncoding="utf-8"%><%  

if (request.getAttribute("header_included") != null)
	return;

request.setAttribute("header_included", true);

JSPUtilService jsputilservice = SpringUtils.getBean(JSPUtilService.class);
Header2Params header2params = jsputilservice.initHeader2(request, response);
String theme = header2params.theme;
String opts = header2params.opts;

%><!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE8" />
<link rel="stylesheet" href="${pageContext.request.contextPath}/themes/<%=theme %>/jquery-ui-1.11.<%=theme %>.min.css">
<% if (request.getAttribute("componentVersion") != null && request.getAttribute("componentVersion").equals("v2")) { %>
<link rel="stylesheet" href="${pageContext.request.contextPath}/antelope/themes/base/bootstrap.min.css">
<script>
	var componentVersion = "v2";
</script>
<%} %>
<link rel="stylesheet" href="${pageContext.request.contextPath}/antelope/themes/base/base.css">
<!--[if gte IE 7]><link href="${pageContext.request.contextPath}/antelope/themes/base/baseie7.css" rel="stylesheet" type="text/css"><![endif]-->
<link rel="stylesheet" href="${pageContext.request.contextPath}/themes/base/base.css">
<link rel="stylesheet" href="${pageContext.request.contextPath}/themes/<%=theme %>/<%=theme %>.min.css">
<link rel="stylesheet" href="${pageContext.request.contextPath}/themes/<%=theme %>/layout-default.css">
<script>var ctxPath = '${pageContext.request.contextPath}';</script>
<script>var ctx = '${pageContext.request.contextPath}';</script>
<script>var opts = <%=opts%>;</script>
<script>var useAlertToShowValidate = <%=SystemOpts.getProperty("enable_alert_validate")%>;</script>
<script>var tempsaveinterval = <%=GlobalConsts.tempAutoSaveInterval%>;</script>
<%--是否为被form嵌套的表单，用于当加载到iframe中的页面为被form嵌套时，验证form将同时验证此iframe中的页面信息
	注意验证时系统认为iframe中的页面已加载完成。
 --%>
<script>var nestedbyform = <%=request.getParameter("nestedbyform")%>;</script>
<script>var component = '<%=TextUtils.noNull(request.getParameter("component"))%>'</script>

<script>

<%
String keys = "antelope.ok,antelope.changetheme,antelope.changelanguage,antelope.register,antelope.cancel,antelope.savesuccess,antelope.confirmok," +
"antelope.close,antelope.form.confirmoperat,antelope.savesuccess,antelope.form.nowprefix,antelope.form.nowsuffix,antelope.ui.fileupload.addattach," +
"antelope.ui.fileupload.allowmax.prefix,antelope.ui.fileupload.allowmax.suffix,antelope.ui.fileupload.fileistobig,antelope.assigneeunit," +
"antelope.assigneename,antelope.auditresult,antelope.auditphase,antelope.auditcomment,antelope.audittime,antelope.operation,antelope.delete," +
"antelope.view,antelope.config,antelope.explain,antelope.release,antelope.modify,antelope.exp,antelope.singleselect,antelope.ordernum," +
"antelope.firstpage,antelope.lastpage,antelope.prepage,antelope.nextpage,antelope.rowperpageprefix,antelope.rowperpagesuffix,antelope.totalpageprefix," +
"antelope.totalpagesuffix,antelope.row,antelope.choose,antelope.confirmtodelete,antelope.ui.uploaddialog.fileupload";

SessionService service = (SessionService) session.getAttribute("service");
I18n i18n = service.getI18n();
JSONObject obj = new JSONObject();
String[] keyarr = keys.split(",");
for (String key : keyarr) {
	obj.put(key, i18n.get(key));
}
obj.put("locale", service.getLocale());
%>
var ___i18nCache = <%=obj %>; 

</script>

<script src="${pageContext.request.contextPath}/js/jquery-1.10.2.min.js"></script>
<script src="${pageContext.request.contextPath}/js/jquery-i18n.min.js"></script>
<script src="${pageContext.request.contextPath}/js/jquery-ui-1.11.2.custom.min.js"></script>
<% if (request.getAttribute("componentVersion") != null && request.getAttribute("componentVersion").equals("v2")) { %>
<script src="${pageContext.request.contextPath}/js/bootstrap.min.js"></script>
<script>var componentsv2 = true;</script>
<% } %>
<script src="${pageContext.request.contextPath}/js/json2.min.js"></script>
<script src="${pageContext.request.contextPath}/js/history.min.js"></script>
<script src="${pageContext.request.contextPath}/js/jquery-jtemplates.min.js"></script>
<script src="${pageContext.request.contextPath}/js/ckeditor/ckeditor.js"></script>
<script src="${pageContext.request.contextPath}/controls/js/jquery-controls-1.0.min.js"></script>
<script src="${pageContext.request.contextPath}/js/jquery-ui.min.js"></script>
<script src="${pageContext.request.contextPath}/js/tiny_mce/jquery.tinymce.js"></script>
<script>
	// iframe外边框高度自调
	$(function(){
		var autoheightifrmid = '<%=TextUtils.noNull(request.getParameter("autoheightifrmid"))%>';
		
		var defaultifrmheight = 800;
		
		<%if (request.getParameter("defaultifrmheight") != null) {%>
		defaultifrmheight = <%=request.getParameter("defaultifrmheight")%>;
		<%}%>
		
		if (!autoheightifrmid)
			return;
		
		parent.$("#" + autoheightifrmid).height(defaultifrmheight);
		
		if ($("body").hasClass("ui-layout")) {
			return;
		}
		
		if (window != top && autoheightifrmid) {
			if ($.browser.msie) {
				setTimeout(function(){
					if ($("body")[0].scrollHeight < defaultifrmheight) {
						parent.$("#" + autoheightifrmid).height(defaultifrmheight);
					} else if (parent.$("#" + autoheightifrmid).height() != $("body")[0].scrollHeight) {
						parent.$("#" + autoheightifrmid).height($("body")[0].scrollHeight);
					}
				}, 50);
				setInterval(function(){
					if ($("body")[0].scrollHeight < defaultifrmheight) {
						parent.$("#" + autoheightifrmid).height(defaultifrmheight);
					} else if (Math.abs(parent.$("#" + autoheightifrmid).height() - $("body")[0].scrollHeight) > 15) {
						parent.$("#" + autoheightifrmid).height($("body")[0].scrollHeight + 10);
					}
				}, 500);
			} else if ($.browser.webkit){
				
				var adjustheight = 20;
				if ($.browser.webkit) {
					adjustheight = 40;
				}
				var ifrmheight = $("body").prop("scrollHeight") + adjustheight;
				setTimeout(function(){
					if (ifrmheight < defaultifrmheight) {
						parent.$("#" + autoheightifrmid).height(defaultifrmheight);
					} else if (parent.$("#" + autoheightifrmid).height() != ifrmheight) {
						parent.$("#" + autoheightifrmid).height(ifrmheight);
					}
				}, 50);
				setInterval(function(){
					ifrmheight = $("body").prop("scrollHeight") + adjustheight;
					if (ifrmheight < defaultifrmheight) {
						parent.$("#" + autoheightifrmid).height(defaultifrmheight);
					} else if (Math.abs(parent.$("#" + autoheightifrmid).height() - (ifrmheight - adjustheight)) > 15) {
						parent.$("#" + autoheightifrmid).height(ifrmheight + 10);
					}
				}, 500);
				
			}
		}
		
	})
</script>


